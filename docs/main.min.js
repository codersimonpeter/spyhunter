var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},ActiveArea=function(t){function e(e,i,r,s,n){var o=t.call(this)||this;return o.graphics.beginFill(0,.6),o.graphics.drawRect(0,0,r,s),o.graphics.endFill(),o.x=e,o.y=i,o.spys=n,o.init(),o}return __extends(e,t),e.prototype.init=function(){var t=new egret.Bitmap(RES.getRes(this.spys[0]));this.roleBitmap=t,this.roleBitmap.touchEnabled=!0,this.roleBitmap.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.addChild(this.roleBitmap)},e.prototype.onTap=function(){this.roleBitmap.touchEnabled=!1,console.log("点击");var t=new SpyEvent(SpyEvent.SPY_TAPED);t._spyName=this.currentRole,this.dispatchEvent(t)},e.prototype.startWork=function(t){void 0===t&&(t=20),this.currentRole=this.spys[0],this.updateRoleBitmap(),this.timer=new egret.Timer(1e3,t),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.timer.start()},e.prototype.onTimerComplete=function(){this.roleBitmap.touchEnabled=!1},e.prototype.onTimer=function(){this.roleBitmap.touchEnabled=!0,this.currentRole=this.getRndSpy(),this.updateRoleBitmap()},e.prototype.updateRoleBitmap=function(){var t=50,e=RES.getRes(this.currentRole);this.roleBitmap.texture=e,this.roleBitmap.x=Math.random()*(this.width-2*t)+t,this.roleBitmap.y=Math.random()*(this.height-2*t)+t,this.roleBitmap.anchorOffsetX=e.textureWidth/2,this.roleBitmap.anchorOffsetY=e.textureHeight/2},e.prototype.getRndSpy=function(){var t=Math.floor(Math.random()*this.spys.length);return this.spys[t]},e}(egret.Sprite);__reflect(ActiveArea.prototype,"ActiveArea");var IntelSys=function(t){function e(e,i,r,s,n){var o=t.call(this)||this;return o.catchCount=0,o.timeLeft=0,o.graphics.beginFill(0,.5),o.graphics.drawRect(0,0,r,s),o.graphics.endFill(),o.x=e,o.y=i,o.spys=n,o.init(),o}return __extends(e,t),e.prototype.init=function(){this.catchCountLabel=new egret.TextField,this.catchCountLabel.width=400,this.catchCountLabel.height=100,this.catchCountLabel.x=20,this.catchCountLabel.text="你抓住了0个间谍",this.catchCountLabel.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(this.catchCountLabel),this.timerLabel=new egret.TextField,this.timerLabel.width=240,this.timerLabel.height=100,this.timerLabel.x=20,this.timerLabel.y=100,this.timerLabel.text="倒计时:0秒",this.timerLabel.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(this.timerLabel);var t=new egret.Bitmap;this.targetSpyBitmap=t,this.targetSpyBitmap.x=380,this.targetSpyBitmap.y=100,this.addChild(this.targetSpyBitmap),this.targetSpy=this.spys[0]},e.prototype.startWork=function(t){void 0===t&&(t=20),this.timeLeft=t,this.catchCount=0,this.updateCatchLabel(),this.updateTimerLabel(),this.updateTargetSpyBitmap(),this.timer=new egret.Timer(1e3,t),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.timer.start()},e.prototype.spyTaped=function(t){t._spyName==this.targetSpy?this.catchCount++:this.catchCount-=2,this.updateCatchLabel()},e.prototype.onTimer=function(){var t=Math.random()>.1428?!1:!0;t&&(this.targetSpy=this.getRndSpy()),this.timeLeft--,this.updateTimerLabel(),this.updateTargetSpyBitmap()},e.prototype.getRndSpy=function(){var t=Math.floor(Math.random()*this.spys.length);return this.spys[t]},e.prototype.onTimerComplete=function(){var t=new SpyEvent(SpyEvent.GAMEOVER);t._count=this.catchCount,this.dispatchEvent(t),this.timerLabel.text="时间到！"},e.prototype.updateCatchLabel=function(){this.catchCountLabel.text="你抓住了 "+this.catchCount+" 个间谍"},e.prototype.updateTimerLabel=function(){this.timerLabel.text="倒计时： "+this.timeLeft+" 秒"},e.prototype.updateTargetSpyBitmap=function(){var t=RES.getRes(this.targetSpy);this.targetSpyBitmap.texture=t,this.targetSpyBitmap.width=t.textureWidth,this.targetSpyBitmap.height=t.textureHeight,this.targetSpyBitmap.anchorOffsetX=t.textureWidth/2,this.targetSpyBitmap.anchorOffsetY=t.textureHeight/2},e}(egret.Sprite);__reflect(IntelSys.prototype,"IntelSys");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.CONFIG_LOAD_ERROR,this.onConfigError,this),console.log("正在加载配置文件"),RES.loadConfig("./resource/default.res.json","resource/")},e.prototype.onConfigError=function(t){},e.prototype.onConfigComplete=function(){console.log("配置文件加载完毕"),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGroupLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGroupLoadProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGroupComplete,this),console.log("正在加载组资源"),RES.loadGroup("spys")},e.prototype.onGroupLoadError=function(){},e.prototype.onGroupLoadProgress=function(){},e.prototype.onGroupComplete=function(){console.log("游戏组资源加载完成"),this.createScene()},e.prototype.createScene=function(){console.log("正在创建游戏场景");var t=this.stage.stageWidth,e=this.stage.stageHeight,i=new egret.Bitmap(RES.getRes("spys.bgTile"));i.fillMode=egret.BitmapFillMode.REPEAT,i.width=t,i.height=e,i.alpha=.5,this.addChild(i);var r=["spys.spy1","spys.spy2","spys.spy3","spys.spy4","spys.spy5","spys.spy6"];this.intelligenceSystem=new IntelSys(0,0,t,200,r),this.addChild(this.intelligenceSystem),this.intelligenceSystem.addEventListener(SpyEvent.GAMEOVER,this.onGameover,this),this.activeArea=new ActiveArea(0,200,t,e-200,r),this.addChild(this.activeArea),this.activeArea.addEventListener(SpyEvent.SPY_TAPED,this.onSpyTaped,this);var s=new egret.Sprite;s.graphics.beginFill(0,.7),s.graphics.drawRect(0,0,t,e),s.graphics.endFill(),this._mask=s;var n=40;this.intelligenceSystem.startWork(n),this.activeArea.startWork(n)},e.prototype.onGameover=function(t){this.addChild(this._mask),console.log("游戏结束,你的得分是: "+10*t._count)},e.prototype.onSpyTaped=function(t){this.intelligenceSystem.spyTaped(t)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var SpyEvent=function(t){function e(e,i,r,s){var n=t.call(this,e,i,r,s)||this;return n._spyName="",n}return __extends(e,t),e}(egret.Event);SpyEvent.SPY_TAPED="spyTaped",SpyEvent.GAMEOVER="gameover",__reflect(SpyEvent.prototype,"SpyEvent");